@model GigHub.ViewModels.GigDetailsViewModel

@{
    ViewBag.Title = "Details";
}

<h2>
    @Model.Gig.Artist.Name
    @if (Model.ShowAction) {
        if (!Model.IsFollowing) {
            <button data-artist-id="@Model.Gig.ArtistId" class="btn btn-default btn-sm js-toggle-follow">Follow ?</button>
        } else {
            <button class="btn btn-info btn-sm">Following</button>
        }
    }
</h2>

<p>Performing at @Model.Gig.Venue on @Model.Gig.DateTime.ToString("dd MMM") at @Model.Gig.DateTime.ToShortTimeString()</p>

@if (Model.IsAttending) {
    <p>You are going to the event.</p>
}

@section scripts{
    <script>
        $(document)
            .ready(function () {
                $(".js-toggle-follow")
                    .click(function (e) {
                        var button = $(e.target);
                        $.post("/api/followings", { "ArtistId": button.attr("data-artist-id") })
                            .done(function () {
                                button
                                    .removeClass("btn-default")
                                    .addClass("btn-info")
                                    .text("Following");
                            })
                            .fail(function () {
                                alert("Something failed!");
                            });
                    });
            });
    </script>
}